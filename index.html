<!DOCTYPE html>
<html lang='en'>
<head>
<title>Weather APP</title>
<meta charset='utf-8'>
<meta name='viewport' content='width=device-width, initial-scale=1'>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bulma@0.8.0/css/bulma.min.css">
  <link href="https://fonts.googleapis.com/css?family=Titillium+Web&display=swap" rel="stylesheet">
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" rel="stylesheet">
  <link href='style.css' rel='stylesheet'>
</head>
<body style="background-image: url(https://lh3.googleusercontent.com/p/AF1QipOWQOnc5H1KaoL3RA5dV1Vvn75adsXwlCG52KP_=s1600-w1600)">
	<nav class="level">
		<div class="level-item has-text-centered">
			<div>
				<h3 class="title is-3">Weather APP</h3>
			</div>
		</div>
		<div class="level-item has-text-centered">
			<div>
				<p class="heading">Followers</p>
				<p class="title"></p>
			</div>
		</div>
		<div class="level-item has-text-centered">
			<div>
				<img id="localIcon" src="#">
				<p class="heading" id="localTemp"></p>
				<p id="date" class="date"><p>
				<p class="title" id="localCity"></p>
			</div>
		</div>
	</nav>
</body>
<script>	
  const fetchCurrentCityName = (function() {
		fetch('https://ipinfo.io?token=311875147c07c2', {mode: 'cors'})
    .then(function(response) {
      return response.json();
    })
    .then(function(response) {
			currentCity(response);
    })
    .catch(e => {
			city.innerHTML = e;
      console.log(e);
    })
	})();
	
	const currentCity = (data) => {
		renderCityName(data.city);
		fetchCurrentCityTemp(data.city);
		googlePlace(data.city);						
	}

	const renderCityName = (cityName) => {
		const localCity = document.getElementById('localCity')
		localCity.innerHTML = cityName;
	}

	const fetchCurrentCityTemp = (cityName) => {
		let location = cityName;
		const baseUrl = 'https://api.openweathermap.org/data/2.5';
		const key = '05f63ad5080a502f607cfa5b1219794b';
		const unit = 'metric';
		const url = `${baseUrl}/weather?q=${location}&units=${unit}&APPID=${key}`;
		fetch(url, {mode: 'cors'})
    .then(function(response) {
      return response.json();
    })
    .then(function(response) {
			getLocalWeather(response);
    })
    .catch(e => {
			localTemp.innerHTML = e;
      console.log(e);
    })
	}

	const getLocalWeather = (weather) => {
		renderLocalTemp(weather.main.temp);
		let img = weather.weather[0].icon;
		renderLocalWeather(img);
	}

	const renderLocalTemp = (temp) => {
		const localTemp = document.getElementById('localTemp');
		localTemp.innerHTML = "Local Temp: " + Math.floor(temp) + "Â°C";
	}

	const renderLocalWeather = (img) => {
		const localIcon = document.getElementById('localIcon');
		let localLink = "https://openweathermap.org/img/w/" + img + ".png"
		localIcon.setAttribute("src", localLink)
	}

	const localTime = (function() {
		const dateElement = document.getElementById("date");
		const format = {weekday:"long", month:"short", day:"numeric", hour: 'numeric', minute: 'numeric',};
		const today = new Date();
		dateElement.innerHTML = today.toLocaleDateString("en-US", format);
	})();

	const googlePlace = (cityName) => {
		let location = cityName;		
		const googleUrl = 'https://maps.googleapis.com/maps/api/place/textsearch';
		const googleKey = 'AIzaSyD6IuIsf8pzDNh1VhJfAdxwjrecp4HacGY';
		const targetUrl = `${googleUrl}/json?query=${location}&key=${googleKey}`;
		fetch(targetUrl, {mode: 'no-cors'})
    .then(function(response) {
			console.log("WTF")
      return response.json();
    })
    .then(function(response) {
			
			console.log(response.results[0].photos[0].photo_reference);
    })
    .catch(e => {
      console.log(e);
    })
	}	

</script>
</html>